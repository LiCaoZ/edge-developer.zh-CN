---
description: 了解在开发 WebView2 应用程序时要使用的开发最佳做法。
title: WebView2 开发的最佳做法
author: MSEdgeTeam
ms.author: msedgedevrel
ms.date: 05/11/2021
ms.topic: conceptual
ms.prod: microsoft-edge
ms.technology: webview
keywords: WebView2、webview2、WebView、webview、edge、最佳做法
ms.openlocfilehash: 5a11f01ec07aea12599c8bdb8428d451ad7bd013
ms.sourcegitcommit: 7945939c29dfdd414020f8b05936f605fa2b640e
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/13/2021
ms.locfileid: "11564747"
---
# <a name="webview2-development-best-practices"></a><span data-ttu-id="01e89-104">WebView2 开发的最佳做法</span><span class="sxs-lookup"><span data-stu-id="01e89-104">WebView2 development best practices</span></span>  

<span data-ttu-id="01e89-105">每个开发团队在构建其应用程序时都遵循不同的做法。</span><span class="sxs-lookup"><span data-stu-id="01e89-105">Every development team follows different practices when building their application.</span></span> <span data-ttu-id="01e89-106">生成 WebView2 应用程序时，建议遵循一些做法。</span><span class="sxs-lookup"><span data-stu-id="01e89-106">When you build WebView2 applications, there are practices we recommend you follow.</span></span> <span data-ttu-id="01e89-107">本文概述了在构建基于生产环境的 WebView2 应用程序时的建议和最佳做法。</span><span class="sxs-lookup"><span data-stu-id="01e89-107">This article outlines those recommendations and best practices for you when building production-based WebView2 applications.</span></span>

## <a name="use-evergreen-webview2-runtime-recommended"></a><span data-ttu-id="01e89-108">使用 Evergreen WebView2 运行时 (推荐) </span><span class="sxs-lookup"><span data-stu-id="01e89-108">Use Evergreen WebView2 Runtime (recommended)</span></span>  

<span data-ttu-id="01e89-109">虽然固定版本具有严格的兼容性要求的应用用例，但我们通常建议使用 Evergreen WebView2 运行时。</span><span class="sxs-lookup"><span data-stu-id="01e89-109">While Fixed Version has its use cases for apps that have strict compatibility requirements, we generally recommend using the Evergreen WebView2 Runtime.</span></span>  <span data-ttu-id="01e89-110">Evergreen WebView2 运行时会自动更新，并包括可用于 WebView2 应用程序的最新功能和安全修补程序。</span><span class="sxs-lookup"><span data-stu-id="01e89-110">The Evergreen WebView2 Runtime updates automatically and includes the latest features and security patches available to your WebView2 application.</span></span> <span data-ttu-id="01e89-111">Evergreen WebView2 运行时还需要减少磁盘上的存储空间。</span><span class="sxs-lookup"><span data-stu-id="01e89-111">The Evergreen WebView2 Runtime also requires less storage space on the disk.</span></span>

<span data-ttu-id="01e89-112">使用 WebView2 应用程序之前，请确保已安装 Evergreen WebView2 运行时。</span><span class="sxs-lookup"><span data-stu-id="01e89-112">Ensure the Evergreen WebView2 Runtime is installed before using your WebView2 application.</span></span>  <span data-ttu-id="01e89-113">有关详细信息，请导航到 [部署 Evergreen WebView2 运行时][Webview2ConceptsDistributionDeployingEvergreenWebview2Runtime]。</span><span class="sxs-lookup"><span data-stu-id="01e89-113">For more information, navigate to [Deploying the Evergreen WebView2 Runtime][Webview2ConceptsDistributionDeployingEvergreenWebview2Runtime].</span></span>  

## <a name="run-compatibility-tests-regularly-when-using-the-evergreen-webview2-runtime"></a><span data-ttu-id="01e89-114">使用 Evergreen WebView2 运行时时定期运行兼容性测试</span><span class="sxs-lookup"><span data-stu-id="01e89-114">Run compatibility tests regularly when using the Evergreen WebView2 Runtime</span></span>

<span data-ttu-id="01e89-115">使用 Evergreen WebView2 运行时时，请确保运行常规兼容性测试。</span><span class="sxs-lookup"><span data-stu-id="01e89-115">When using the Evergreen WebView2 Runtime, ensure you run regular compatibility tests.</span></span> <span data-ttu-id="01e89-116">由于运行时自动更新，因此请针对非稳定版本的 Microsoft Edge 测试 WebView2 控件中的 Web 内容，以确保 WebView2 应用程序按预期运行。</span><span class="sxs-lookup"><span data-stu-id="01e89-116">Because the runtime updates automatically, test the web content in the WebView2 control against the non-stable versions of Microsoft Edge to ensure that your WebView2 application performs as expected.</span></span> <span data-ttu-id="01e89-117">本指南类似于我们向 Web 开发人员提供的指导。</span><span class="sxs-lookup"><span data-stu-id="01e89-117">This guidance is similar to the guidance that we give to web developers.</span></span> <span data-ttu-id="01e89-118">有关详细信息，请导航到"[在常青模式下保持兼容"。][Webview2ConceptsDistributionStayCompatibleEvergreenMode]</span><span class="sxs-lookup"><span data-stu-id="01e89-118">For more information, navigate to [Stay compatible in Evergreen mode][Webview2ConceptsDistributionStayCompatibleEvergreenMode].</span></span>

## <a name="ensure-apis-are-supported-by-the-installed-webview2-runtime"></a><span data-ttu-id="01e89-119">确保安装的 WebView2 运行时支持 API</span><span class="sxs-lookup"><span data-stu-id="01e89-119">Ensure APIs are supported by the installed WebView2 Runtime</span></span>

<span data-ttu-id="01e89-120">WebView2 应用程序需要同时在计算机上安装 Webview2 SDK 和 WebView2 运行时来运行。</span><span class="sxs-lookup"><span data-stu-id="01e89-120">WebView2 applications need both a Webview2 SDK, and a WebView2 Runtime installed on the computer to run.</span></span> <span data-ttu-id="01e89-121">SDK 和运行时都进行版本控制。</span><span class="sxs-lookup"><span data-stu-id="01e89-121">Both the SDK and the runtime are versioned.</span></span> <span data-ttu-id="01e89-122">由于 API 不断添加到 WebView2，因此也发布了新版本的运行时以支持新的 API。</span><span class="sxs-lookup"><span data-stu-id="01e89-122">Since APIs are continually being added to WebView2, new versions of the runtime are also released to support the new APIs.</span></span> <span data-ttu-id="01e89-123">需要确保安装在该计算机的 WebView2 运行时支持 WebView2 应用程序使用的 API。</span><span class="sxs-lookup"><span data-stu-id="01e89-123">You'll need to ensure that the APIs used by your WebView2 application are supported by the WebView2 Runtime that's installed on the computer.</span></span> 

<span data-ttu-id="01e89-124">如果使用 Evergreen WebView2 运行时，则在某些情况下可能不会将运行时更新为使用最新版本。</span><span class="sxs-lookup"><span data-stu-id="01e89-124">If you use the Evergreen WebView2 Runtime, there are some scenarios where the runtime may not be updated to use the latest version.</span></span> <span data-ttu-id="01e89-125">例如，当用户无法访问 Internet 时，该环境中不会自动更新运行时。</span><span class="sxs-lookup"><span data-stu-id="01e89-125">For example, when users don't have internet access, the runtime isn't  automatically updated in that environment.</span></span> <span data-ttu-id="01e89-126">此外，使用某些组策略将暂停 WebView2 更新。</span><span class="sxs-lookup"><span data-stu-id="01e89-126">Additionally, using some group policies pause WebView2 updates.</span></span> <span data-ttu-id="01e89-127">当你将更新推送到 WebView2 应用程序时，应用程序可能会中断，因为它使用的较新的 API 在安装的运行时中不可用。</span><span class="sxs-lookup"><span data-stu-id="01e89-127">When you push an update to your WebView2 application, the application may break because it uses newer APIs that are not available in the installed runtime.</span></span>   
 
<span data-ttu-id="01e89-128">若要解决此问题，可以在代码调用 API 之前测试 API 在已安装的运行时中的可用性。</span><span class="sxs-lookup"><span data-stu-id="01e89-128">To solve this situation, you can test for the availability of the APIs in the installed runtime, before your code calls the API.</span></span> <span data-ttu-id="01e89-129">此较新功能测试与其他 Web 开发最佳实践类似，这些最佳实践在使用新的 Web API 之前检测支持的功能。</span><span class="sxs-lookup"><span data-stu-id="01e89-129">This test for newer functionality is similar to other web development best practices that detect supported features before using new web APIs.</span></span> <span data-ttu-id="01e89-130">若要测试已安装运行时中的 API 可用性，请使用：</span><span class="sxs-lookup"><span data-stu-id="01e89-130">To test for API availability in the installed runtime, use:</span></span>  

*   <span data-ttu-id="01e89-131">`queryinterface`C/C++ 中的 。</span><span class="sxs-lookup"><span data-stu-id="01e89-131">The `queryinterface` in C/C++.</span></span> 
*   <span data-ttu-id="01e89-132">.NET 或 WinUI 中的 try/catch 块。</span><span class="sxs-lookup"><span data-stu-id="01e89-132">A try/catch block in .NET or WinUI.</span></span> 
    
<span data-ttu-id="01e89-133">有关详细信息，请导航到确定 [WebView2 运行时要求][Webview2ConceptsVersioningDetermineWebview2RuntimeRequirement]。</span><span class="sxs-lookup"><span data-stu-id="01e89-133">For more information, navigate to [Determine WebView2 Runtime requirement][Webview2ConceptsVersioningDetermineWebview2RuntimeRequirement].</span></span>  

## <a name="update-the-fixed-version-runtime"></a><span data-ttu-id="01e89-134">更新固定版本运行时</span><span class="sxs-lookup"><span data-stu-id="01e89-134">Update the Fixed Version Runtime</span></span>  

<span data-ttu-id="01e89-135">如果使用固定版本运行时，请确保定期更新运行时，以减少任何潜在的安全风险。</span><span class="sxs-lookup"><span data-stu-id="01e89-135">If you use the Fixed Version Runtime, ensure you update your runtime regularly to reduce any potential security risk.</span></span> <span data-ttu-id="01e89-136">在 Webview2 应用程序中使用第三方内容时，始终认为内容不受信任。</span><span class="sxs-lookup"><span data-stu-id="01e89-136">When using 3rd-party content in Webview2 applications, always consider the content untrusted.</span></span>  <span data-ttu-id="01e89-137">有关详细信息，请导航到"[固定版本分发模式"。][Webview2ConceptsDistributionFixedVersionDistributionMode]</span><span class="sxs-lookup"><span data-stu-id="01e89-137">For more information, navigate to [Fixed Version distribution mode][Webview2ConceptsDistributionFixedVersionDistributionMode].</span></span>  

## <a name="manage-new-versions-of-the-runtime"></a><span data-ttu-id="01e89-138">管理新版本的运行时</span><span class="sxs-lookup"><span data-stu-id="01e89-138">Manage new versions of the runtime</span></span>  

<span data-ttu-id="01e89-139">只要将新版本的 Evergreen WebView2 运行时下载到设备，运行 WebView2 应用程序就会继续使用以前的运行时，直到浏览器进程发布。</span><span class="sxs-lookup"><span data-stu-id="01e89-139">Whenever a new version of the Evergreen WebView2 Runtime is downloaded to the device, running WebView2 applications continue using the previous runtime until the browser process is released.</span></span> <span data-ttu-id="01e89-140">此行为允许应用程序连续运行，并阻止删除以前的运行时。</span><span class="sxs-lookup"><span data-stu-id="01e89-140">This behavior allows applications to run continuously, and prevents the previous runtime from being deleted.</span></span> <span data-ttu-id="01e89-141">若要使用新版本的运行时，你需要释放对以前的 WebView2 环境对象的所有引用或重新启动应用程序。</span><span class="sxs-lookup"><span data-stu-id="01e89-141">To use the new version of the runtime, you'll need to release all references to the previous WebView2 environment objects or restart your application.</span></span> <span data-ttu-id="01e89-142">下次创建新的 WebView2 环境时，它将使用新版本。</span><span class="sxs-lookup"><span data-stu-id="01e89-142">The next time you create a new WebView2 environment, it will use the new version.</span></span>

<span data-ttu-id="01e89-143">若要在新版本可用时采取措施，例如通知用户重新启动应用程序，可以在代码中使用 [add_NewBrowserVersionAvailable (Win32) ][Webview2ReferenceaddNewBrowserVersionAvailable] 或 [CoreWebView2Environment.NewBrowserVersionAvailable (.NET) ][Webview2ReferenceNewBrowserVersionAvailable] 事件。</span><span class="sxs-lookup"><span data-stu-id="01e89-143">To take action when a new version is available, such as notifying the user to restart the application, you can use the [add_NewBrowserVersionAvailable(Win32)][Webview2ReferenceaddNewBrowserVersionAvailable] or [CoreWebView2Environment.NewBrowserVersionAvailable(.NET)][Webview2ReferenceNewBrowserVersionAvailable] event in your code.</span></span> <span data-ttu-id="01e89-144">如果代码处理重新启动应用程序，请考虑在 WebView2 应用程序退出之前保存用户状态。</span><span class="sxs-lookup"><span data-stu-id="01e89-144">If your code handles restarting the application, consider saving the user state before the WebView2 application exits.</span></span>  

## <a name="manage-the-lifetime-of-the-user-data-folder"></a><span data-ttu-id="01e89-145">管理用户数据文件夹的生命周期</span><span class="sxs-lookup"><span data-stu-id="01e89-145">Manage the lifetime of the user data folder</span></span> 
<span data-ttu-id="01e89-146">WebView2 应用创建用户数据文件夹来存储 Cookie、凭据、权限等数据。</span><span class="sxs-lookup"><span data-stu-id="01e89-146">WebView2 apps create a user data folder to store data such as cookies, credentials, permissions, and so on.</span></span> <span data-ttu-id="01e89-147">创建文件夹后，你的应用负责管理用户数据文件夹的生命周期，包括在卸载应用时清理。</span><span class="sxs-lookup"><span data-stu-id="01e89-147">After creating the folder, your app is responsible for managing the lifetime of the user data folder, including clean up when the app is uninstalled.</span></span>  <span data-ttu-id="01e89-148">有关详细信息，请导航到"[管理用户数据文件夹"。][Webview2ConceptsUserDataFolder]</span><span class="sxs-lookup"><span data-stu-id="01e89-148">For more information, navigate to [Managing the User Data Folder][Webview2ConceptsUserDataFolder].</span></span>  

## <a name="follow-recommended-webview2-security-best-practices"></a><span data-ttu-id="01e89-149">遵循建议的 WebView2 安全性最佳做法</span><span class="sxs-lookup"><span data-stu-id="01e89-149">Follow recommended WebView2 security best practices</span></span> 
<span data-ttu-id="01e89-150">对于任何 WebView2 应用程序，请确保遵循我们建议的 WebView2 安全性最佳做法。</span><span class="sxs-lookup"><span data-stu-id="01e89-150">For any WebView2 application, ensure you follow our recommended WebView2 security best practices.</span></span>  <span data-ttu-id="01e89-151">有关详细信息，请导航到 [Best practices for developing secure WebView2 applications][Webview2ConceptsSecurity]。</span><span class="sxs-lookup"><span data-stu-id="01e89-151">For more information, navigate to [Best practices for developing secure WebView2 applications][Webview2ConceptsSecurity].</span></span>  

<!-- links -->  

[Webview2ConceptsDistributionDeployingEvergreenWebview2Runtime]: ../concepts/distribution.md#deploying-the-evergreen-webview2-runtime "部署 Evergreen WebView2 运行时 - 使用 WebView2 |Microsoft Docs"  
[Webview2ConceptsDistributionFixedVersionDistributionMode]: ../concepts/distribution.md#fixed-version-distribution-mode "固定版本分发模式 - 使用 WebView2 分发|Microsoft Docs"  
[Webview2ConceptsDistributionStayCompatibleEvergreenMode]: ../concepts/distribution.md#stay-compatible-in-evergreen-mode "在常青模式中保持兼容 - 使用 WebView2 模式分配|Microsoft Docs"  
[Webview2ConceptsSecurity]: ../concepts/security.md "开发安全 WebView2 应用程序应用程序的最佳实践|Microsoft Docs"  
[Webview2ConceptsUserDataFolder]: ../concepts/user-data-folder.md "管理用户数据文件夹|Microsoft Docs"  
[Webview2ConceptsVersioningDetermineWebview2RuntimeRequirement]: ../concepts/versioning.md#determine-webview2-runtime-requirement "确定 WebView2 运行时要求 - 了解 WebView2 SDK |Microsoft Docs"  
[Webview2GetStartedWin32]: ../get-started/win32.md "WebView2 |Microsoft Docs"  
[Webview2GetStartedWinforms]: ../get-started/winforms.md "Windows Forms | 中的 WebView2 入门Microsoft Docs"  
[Webview2GetStartedWinui]: ../get-started/winui.md "WinUI 3 预览版中的 WebView2 (入门) |Microsoft Docs"  
[Webview2GetStartedWpf]: ../get-started/wpf.md "WPF | 中的 WebView2 入门Microsoft Docs"  

[Webview2ReferenceaddNewBrowserVersionAvailable]: /microsoft-edge/webview2/reference/win32/icorewebview2environment#add_newbrowserversionavailable "add_NewBrowserVersionAvailable |Microsoft Docs"  

[Webview2ReferenceNewBrowserVersionAvailable]: /dotnet/api/microsoft.web.webview2.core.corewebview2environment.newbrowserversionavailable "CoreWebView2Environment.NewBrowserVersionAvailable 事件|Microsoft Docs"  
